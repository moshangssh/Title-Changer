# Title Changer 插件重构进度

## 已完成工作

### 基础架构

1. ✅ 创建了`AbstractView`抽象基类（`src/views/base/abstract-view.ts`）
   - 提供所有视图组件共享的基本结构和方法
   - 定义了初始化、更新和卸载的抽象方法
   - 提供了日志记录和错误处理的通用方法

2. ✅ 创建了`FileService`服务（`src/services/file.service.ts`）
   - 负责文件查找和路径解析
   - 提供了获取文件基本名称、文件夹路径等功能
   - 统一了文件操作的错误处理

3. ✅ 创建了`TitleService`服务（`src/services/title.service.ts`）
   - 负责处理标题获取和缓存
   - 提供了获取显示标题、处理文件标题等功能
   - 依赖`FileService`进行文件操作

4. ✅ 创建了`UpdateScheduler`服务（`src/services/update-scheduler.service.ts`）
   - 处理视图更新的调度和防抖
   - 提供了延迟更新、立即更新、延迟立即更新等功能
   - 统一了更新调度的错误处理

5. ✅ 更新了依赖注入容器配置（`src/inversify.config.ts`）
   - 添加了新服务的注册
   - 确保所有服务以单例模式注册

6. ✅ 更新了类型定义（`src/types/symbols.ts`）
   - 添加了新服务的符号定义

## 待完成工作

### 视图组件重构

1. ⬜ 重构`EditorLinkView`组件（`src/views/editor-view.ts`）
   - 继承自`AbstractView`抽象基类
   - 使用`TitleService`和`UpdateScheduler`服务
   - 移除重复的文件查找和标题处理逻辑

2. ⬜ 重构`ReadingView`组件（`src/views/reading-view.ts`）
   - 继承自`AbstractView`抽象基类
   - 使用`TitleService`和`UpdateScheduler`服务
   - 移除重复的文件查找和标题处理逻辑

3. ⬜ 重构`ExplorerView`组件（`src/views/explorer-view.ts`）
   - 继承自`AbstractView`抽象基类
   - 使用`TitleService`和`UpdateScheduler`服务
   - 移除自定义的更新调度逻辑

### 测试和验证

1. ⬜ 更新测试用例
   - 为新增的服务添加单元测试
   - 更新现有视图组件的测试

2. ⬜ 进行集成测试
   - 确保所有视图组件正常工作
   - 验证插件功能完整性

## 后续工作

1. ⬜ 进一步提取DOM操作逻辑到专门的助手类
2. ⬜ 考虑引入响应式模式，减少更新调度复杂度
3. ⬜ 更新文档，反映新的架构和服务使用方法

## 重构收益

1. 代码量减少 - 消除重复代码
2. 可维护性提高 - 更清晰的责任分离
3. 可扩展性增强 - 新功能可以直接使用现有服务
4. 错误处理统一 - 通过统一的服务层进行错误处理
5. 测试性改进 - 服务层更易于进行单元测试

## 更新日志

### 2023-04-01
- 完成基础架构建设
- 创建核心服务和抽象基类
- 更新DI容器配置 